<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="img-src https://*; media-src https://*;"
    />
    <meta name="description" content="A simple video slider with loading bar" />
    <meta name="keywords" content="video, slider, loading" />
    <meta name="omarmhawash" content="Vide Hero slider" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="style.keyframes.css" />

    <title>Vide Hero Slider</title>
  </head>
  <body>
    <div id="hero-video-slider">
      <div class="videos">
        <div class="video-item">
          <div class="video-wrapper">
            <video
              src="https://www.datocms-assets.com/22581/1603987542-2-pexels.mp4"
              playsinline
              loop
              muted
            />
          </div>
          <div class="desc-shadow"></div>
          <div class="hero-desc">
            <h1>Title X</h1>
            <p>
              Lorem ipsum dolor sit, amet consectetur adipisicing elit.
              Assumenda distinctio necessitatibus corrupti quo ratione, itaque
              dolore repellendus delectus incidunt animi eos eum sit officiis
              quia ab! Alias, quas labore? Impedit!
            </p>
            <button>Play ▶</button>
          </div>
        </div>
        <div class="video-item">
          <div class="video-wrapper">
            <video
              src="https://www.datocms-assets.com/22581/1603987530-1-pixabay.mp4"
              playsinline
              loop
              muted
            />
          </div>
          <div class="desc-shadow"></div>
          <div class="hero-desc">
            <h1>Another Title</h1>
            <p>
              Lorem ipsum dolor, sit amet consectetur adipisicing elit. Dolores
              reiciendis magnam quidem consequuntur repellendus tempore harum
              porro veniam. Quas aspernatur voluptate repudiandae ad explicabo
              eos necessitatibus ut enim sequi ipsa!
            </p>
            <button>Play ▶</button>
          </div>
        </div>
        <div class="video-item">
          <div class="video-wrapper">
            <video
              src="https://www.datocms-assets.com/22581/1603987638-5-life-of-vids.mp4"
              playsinline
              loop
              muted
            />
          </div>
          <div class="desc-shadow"></div>
          <div class="hero-desc">
            <h1>Another Title</h1>
            <p>
              Lorem ipsum dolor sit, amet consectetur adipisicing elit. Illo,
              fugiat dolores ullam nam doloremque adipisci doloribus beatae ad
              quae corrupti repellendus, ipsa atque impedit soluta sit?
              Explicabo reiciendis dignissimos nihil.
            </p>
            <button>Play ▶</button>
          </div>
        </div>
      </div>
      <div class="loading-percent" />
    </div>
  </body>
  <script>
    const videoItems = document.getElementsByClassName("video-item");
    const videoTags = document.getElementsByTagName("video");
    const aBox = document.querySelector(".loading-percent");

    const videosLength = videoItems.length;
    let videoIdx = 0;
    let loadPer = 2;
    const loopTime = 5000;

    function hideVideos(showIndex) {
      for (let i = 0; i < videoItems.length; i++) {
        const rmTime =
          (videoTags[i].duration - videoTags[i].currentTime) * 1000;
        if (showIndex != i) {
          videoItems[i].style.display = "none";
          videoTags[i].pause();
          if (i > 0 && rmTime < loopTime) {
            videoTags[i].currentTime = 0;
            console.log(rmTime, loopTime);
          }
        } else {
          videoItems[i].style.display = "block";
          videoTags[i].play();
        }
      }
    }

    function loopVideos() {
      console.log("videos at", videoIdx);
      hideVideos(videoIdx);
      videoIdx = (videoIdx + 1) % videosLength;
    }
    function updateLoading() {
      aBox.style.cssText = `width:${loadPer}%`;
      loadPer = (loadPer + 1) % 100;
    }

    // main
    hideVideos(0);
    loopVideos();
    setInterval(() => {
      loopVideos();
      loadPer = 2;
    }, loopTime);
    setInterval(() => {
      updateLoading();
    }, 50);

    //* hover effect testing
    // const desc = document.querySelector(".hero-desc");
    // desc.addEventListener("mouseenter", () => {

    // });
  </script>
</html>
